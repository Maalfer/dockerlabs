{% extends "base.html" %}

{% block title %}Peticiones - DockerLabs{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="welcome-section">
            <h1>Centro de peticiones</h1>
            <p class="welcome-text">
                Gestión de reclamaciones de autoría, peticiones de edición de máquinas, peticiones de cambio de username
                y peticiones de registro de nombres duplicados.
            </p>
        </div>
    </div>

    <div class="dashboard-content">

        {% if claims %}
        <div class="claims-section">
            <div class="section-header">
                <h2><i class="bi bi-flag"></i> Reclamaciones de autoría de máquinas</h2>
                <p class="section-subtitle">
                    Revisa y gestiona las peticiones de autoría enviadas por los usuarios.
                </p>
            </div>

            {% set pendientes = claims | selectattr("estado", "equalto", "pendiente") | list %}
            {% set no_pendientes = claims | rejectattr("estado", "equalto", "pendiente") | list %}

            <div class="section-body">
                {% if pendientes|length > 0 %}
                <h5 class="mb-3 text-warning">Pendientes</h5>

                {% for c in pendientes %}
                <div class="claim-card">
                    <div class="claim-header d-flex justify-content-between align-items-center">
                        <span class="claim-machine"><i class="bi bi-cpu"></i> {{ c.maquina_nombre }}</span>
                        <span class="claim-status badge bg-warning text-dark text-uppercase">{{ c.estado }}</span>
                    </div>

                    <div class="claim-body">
                        <p><strong>Usuario:</strong> {{ c.username }}</p>
                        <p><strong>Contacto:</strong> {{ c.contacto | e }}</p>
                        <p><strong>Prueba aportada:</strong></p>
                        <p class="claim-proof">{{ c.prueba | e }}</p>
                        <p class="claim-date"><small>Recibida: {{ c.created_at }}</small></p>

                        {% if current_user_role == 'admin' %}
                        <div class="claim-actions d-flex gap-2 mt-2">
                            <form method="post" action="{{ url_for('maquinas.approve_claim', claim_id=c.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-sm btn-success"><i class="bi bi-check-circle"></i>
                                    Aprobar</button>
                            </form>
                            <form method="post" action="{{ url_for('maquinas.reject_claim', claim_id=c.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-x-circle"></i>
                                    Rechazar</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted">No hay reclamaciones pendientes.</p>
                {% endif %}

                <hr class="my-4">

                {% if no_pendientes|length > 0 %}
                <button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#reclamacionesArchivadas">Mostrar reclamaciones aprobadas / rechazadas</button>

                <div class="collapse" id="reclamacionesArchivadas">
                    {% for c in no_pendientes %}
                    <div class="claim-card mt-3">
                        <div class="claim-header d-flex justify-content-between align-items-center">
                            <span class="claim-machine"><i class="bi bi-cpu"></i> {{ c.maquina_nombre }}</span>
                            <div class="d-flex align-items-center gap-2">
                                <span
                                    class="claim-status badge text-uppercase {% if c.estado == 'aprobada' %}bg-success{% elif c.estado == 'rechazada' %}bg-danger{% endif %}">{{
                                    c.estado }}</span>
                                <form method="post" action="{{ url_for('maquinas.revert_claim', claim_id=c.id) }}"
                                    style="display:inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-secondary"
                                        title="Revertir a pendiente"><i
                                            class="bi bi-arrow-counterclockwise"></i></button>
                                </form>
                            </div>
                        </div>
                        <div class="claim-body">
                            <p><strong>Usuario:</strong> {{ c.username }}</p>
                            <p><strong>Contacto:</strong> {{ c.contacto | e }}</p>
                            <p><strong>Prueba aportada:</strong></p>
                            <p class="claim-proof">{{ c.prueba | e }}</p>
                            <p class="claim-date"><small>Recibida: {{ c.created_at }}</small></p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No hay reclamaciones aprobadas o rechazadas.</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <hr class="my-5">

        {% if username_change_requests %}
        <div class="claims-section">
            <div class="section-header">
                <h2><i class="bi bi-person-circle"></i> Peticiones de cambio de nombre de usuario</h2>
                <p class="section-subtitle">Solicitudes enviadas por los usuarios que requieren aprobación.</p>
            </div>

            {% set pendientes_un = username_change_requests | selectattr("estado", "equalto", "pendiente") | list %}
            {% set otras_un = username_change_requests | rejectattr("estado", "equalto", "pendiente") | list %}

            <div class="section-body">

                {% if pendientes_un|length > 0 %}
                <h5 class="mb-3 text-warning">Pendientes</h5>

                {% for r in pendientes_un %}
                <div class="claim-card">

                    {% if r.conflict_count and r.conflict_count|int > 0 %}
                    <div class="alert alert-warning mb-2">
                        <strong>Advertencia:</strong> El nombre solicitado coincide con el autor de {{ r.conflict_count
                        }} writeup(s).
                        {% if r.conflict_examples %}
                        <div class="mt-1">Ejemplos: {{ r.conflict_examples | e }}</div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <div class="claim-header d-flex justify-content-between align-items-center">
                        <span class="claim-machine">{{ r.old_username }} → {{ r.requested_username }}</span>
                        <span class="claim-status badge bg-warning text-dark text-uppercase">{{ r.estado }}</span>
                    </div>

                    <div class="claim-body">
                        <p><strong>ID Usuario:</strong> {{ r.user_id }}</p>
                        <p><strong>Correo:</strong> {{ r.user_email }}</p>
                        <p><strong>Contacto opcional:</strong> {{ r.contacto_opcional | e }}</p>
                        <p><strong>Motivo:</strong></p>
                        <p class="claim-proof">{{ (r.reason or "—") | e }}</p>
                        <p class="claim-date"><small>Solicitada: {{ r.created_at }}</small></p>

                        {% if current_user_role in ["admin","moderador"] %}
                        <div class="claim-actions d-flex gap-2 mt-3">
                            <form method="post" action="{{ url_for('auth.approve_username_change', request_id=r.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button class="btn btn-sm btn-success">Aprobar</button>
                            </form>

                            <form method="post" action="{{ url_for('auth.reject_username_change', request_id=r.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="text" name="decision_reason" class="form-control form-control-sm"
                                    placeholder="Motivo (opcional)">
                                <button class="btn btn-sm btn-danger">Rechazar</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted">No hay solicitudes de cambio de username pendientes.</p>
                {% endif %}

                <hr class="my-4">

                {% if otras_un|length > 0 %}
                <button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#usernameArchivadas">Mostrar procesadas</button>

                <div class="collapse" id="usernameArchivadas">
                    {% for r in otras_un %}
                    <div class="claim-card">
                        <div class="claim-header d-flex justify-content-between align-items-center">
                            <span class="claim-machine">{{ r.old_username }} → {{ r.requested_username }}</span>
                            <div class="d-flex align-items-center gap-2">
                                <span
                                    class="claim-status badge text-uppercase {% if r.estado=='aprobada' %}bg-success{% else %}bg-danger{% endif %}">{{
                                    r.estado }}</span>
                                <form method="post"
                                    action="{{ url_for('auth.revert_username_change', request_id=r.id) }}"
                                    style="display:inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-secondary"
                                        title="Revertir a pendiente"><i
                                            class="bi bi-arrow-counterclockwise"></i></button>
                                </form>
                            </div>
                        </div>

                        <div class="claim-body">
                            <p><strong>ID Usuario:</strong> {{ r.user_id }}</p>
                            <p><strong>Correo:</strong> {{ r.user_email }}</p>
                            <p><strong>Contacto opcional:</strong> {{ r.contacto_opcional | e }}</p>
                            <p><strong>Motivo:</strong></p>
                            <p class="claim-proof">{{ (r.reason or "—") | e }}</p>
                            <p><strong>Procesado por:</strong> {{ r.processed_by }}</p>
                            <p><strong>Fecha:</strong> {{ r.processed_at }}</p>
                            <p><strong>Motivo decisión:</strong> {{ r.decision_reason | e }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No hay solicitudes procesadas.</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <hr class="my-5">

        <div class="claims-section">
            <div class="section-header">
                <h2><i class="bi bi-wrench-adjustable"></i> Peticiones de edición de máquinas</h2>
                <p class="section-subtitle">Cambios enviados por los autores que requieren aprobación.</p>
            </div>

            <div class="section-body">
                {% if machine_edit_requests %}
                {% set pendientes_m = machine_edit_requests | selectattr("estado", "equalto", "pendiente") | list %}
                {% set archivadas_m = machine_edit_requests | rejectattr("estado", "equalto", "pendiente") | list %}

                {% if pendientes_m|length > 0 %}
                <h5 class="mb-3 text-warning">Pendientes</h5>

                {% for r in pendientes_m %}
                <div class="claim-card">
                    <div class="claim-header d-flex justify-content-between align-items-center">
                        <span class="claim-machine"><i class="bi bi-cpu"></i> Máquina ID {{ r.machine_id }} | {{
                            r.origen }}</span>
                        <span class="claim-status badge bg-warning text-dark text-uppercase">{{ r.estado }}</span>
                    </div>

                    <div class="claim-body">
                        <p><strong>Autor:</strong> {{ r.autor }}</p>
                        <p><strong>Fecha:</strong> {{ r.fecha }}</p>

                        <h6 class="mt-3">Cambios propuestos</h6>
                        <ul class="claim-details">
                            <li><strong>Nombre:</strong> {{ r.nuevos.nombre }}</li>
                            <li><strong>Dificultad:</strong> {{ r.nuevos.dificultad }}</li>
                            <li><strong>Clase:</strong> {{ r.nuevos.clase }}</li>
                            <li><strong>Color:</strong> {{ r.nuevos.color }}</li>
                            <li><strong>Autor:</strong> {{ r.nuevos.autor }}</li>
                            <li><strong>Enlace autor:</strong> {{ r.nuevos.enlace_autor | e }}</li>
                            <li><strong>Fecha:</strong> {{ r.nuevos.fecha }}</li>
                            <li><strong>Imagen:</strong> {{ r.nuevos.imagen }}</li>
                            <li><strong>Descripción:</strong> {{ r.nuevos.descripcion | e }}</li>
                            <li><strong>Link descarga:</strong> {{ r.nuevos.link_descarga | e }}</li>
                            <li><strong>Posición:</strong> {{ r.nuevos.posicion }}</li>
                        </ul>

                        <div class="claim-actions d-flex gap-2 mt-3">
                            <form method="post"
                                action="{{ url_for('maquinas.approve_machine_edit', request_id=r.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button class="btn btn-sm btn-success" type="submit">Aprobar</button>
                            </form>

                            <form method="post" action="{{ url_for('maquinas.reject_machine_edit', request_id=r.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button class="btn btn-sm btn-danger" type="submit">Rechazar</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted">No hay peticiones de edición de máquinas pendientes.</p>
                {% endif %}

                <hr class="my-4">

                {% if archivadas_m|length > 0 %}
                <button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#machinesArchivadas">Mostrar peticiones archivadas</button>

                <div class="collapse" id="machinesArchivadas">
                    {% for r in archivadas_m %}
                    <div class="claim-card mt-3">
                        <div class="claim-header d-flex justify-content-between align-items-center">
                            <span class="claim-machine"><i class="bi bi-cpu"></i> Máquina ID {{ r.machine_id }}</span>
                            <div class="d-flex align-items-center gap-2">
                                <span
                                    class="claim-status badge text-uppercase {% if r.estado=='aprobada' %}bg-success{% else %}bg-danger{% endif %}">{{
                                    r.estado }}</span>
                                <form method="post"
                                    action="{{ url_for('maquinas.revert_machine_edit', request_id=r.id) }}"
                                    style="display:inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-secondary"
                                        title="Revertir a pendiente"><i
                                            class="bi bi-arrow-counterclockwise"></i></button>
                                </form>
                            </div>
                        </div>

                        <div class="claim-body">
                            <h6>Datos propuestos</h6>
                            <ul class="claim-details">
                                <li><strong>Nombre:</strong> {{ r.nuevos.nombre }}</li>
                                <li><strong>Dificultad:</strong> {{ r.nuevos.dificultad }}</li>
                                <li><strong>Clase:</strong> {{ r.nuevos.clase }}</li>
                                <li><strong>Color:</strong> {{ r.nuevos.color }}</li>
                                <li><strong>Autor:</strong> {{ r.nuevos.autor }}</li>
                                <li><strong>Enlace autor:</strong> {{ r.nuevos.enlace_autor | e }}</li>
                                <li><strong>Fecha:</strong> {{ r.nuevos.fecha }}</li>
                                <li><strong>Imagen:</strong> {{ r.nuevos.imagen }}</li>
                                <li><strong>Descripción:</strong> {{ r.nuevos.descripcion | e }}</li>
                                <li><strong>Link descarga:</strong> {{ r.nuevos.link_descarga | e }}</li>
                                <li><strong>Posición:</strong> {{ r.nuevos.posicion }}</li>
                            </ul>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No hay peticiones de edición de máquinas archivadas.</p>
                {% endif %}

                {% else %}
                <p>No hay peticiones de edición de máquinas.</p>
                {% endif %}
            </div>
        </div>

        <hr class="my-5">

        <div class="claims-section">
            <div class="section-header">
                <h2><i class="bi bi-person-badge"></i> Peticiones de registro de nombres duplicados</h2>
                <p class="section-subtitle">Solicitudes de usuarios que quieren registrar un nombre ya existente o
                    similar.</p>
            </div>

            <div class="section-body">
                {% if peticiones_nombres %}
                {% set pendientes_n = peticiones_nombres | selectattr("estado", "equalto", "pendiente") | list %}
                {% set archivadas_n = peticiones_nombres | rejectattr("estado", "equalto", "pendiente") | list %}

                {% if pendientes_n|length > 0 %}
                <h5 class="text-warning mb-3">Pendientes</h5>

                {% for p in pendientes_n %}
                <div class="claim-card">
                    <div class="claim-header d-flex justify-content-between align-items-center">
                        <span class="claim-machine"><i class="bi bi-person-circle"></i> {{ p.nombre_solicitado }}</span>
                        <span class="claim-status badge bg-warning text-dark text-uppercase">{{ p.estado }}</span>
                    </div>

                    <div class="claim-body">
                        <p><strong>Usuario:</strong> {{ p.username }}</p>
                        <p><strong>Correo:</strong> {{ p.email }}</p>
                        <p><strong>Nombre actual:</strong> {{ p.nombre_actual }}</p>
                        <p><strong>Motivo:</strong></p>
                        <p class="claim-proof">{{ p.motivo | e }}</p>
                        <p class="claim-date"><small>Solicitada: {{ p.created_at }}</small></p>

                        {% if current_user_role in ['admin','moderador'] %}
                        <div class="claim-actions d-flex gap-2 mt-3">
                            <form method="post" action="{{ url_for('approve_nombre_claim', claim_id=p.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button class="btn btn-sm btn-success">Aprobar</button>
                            </form>

                            <form method="post" action="{{ url_for('reject_nombre_claim', claim_id=p.id) }}">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button class="btn btn-sm btn-danger">Rechazar</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted">No hay peticiones pendientes.</p>
                {% endif %}

                <hr class="my-4">

                {% if archivadas_n|length > 0 %}
                <button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#nombresArchivados">Mostrar archivadas</button>

                <div class="collapse" id="nombresArchivados">
                    {% for p in archivadas_n %}
                    <div class="claim-card mt-3">
                        <div class="claim-header d-flex justify-content-between align-items-center">
                            <span class="claim-machine"><i class="bi bi-person-circle"></i> {{ p.nombre_solicitado
                                }}</span>
                            <div class="d-flex align-items-center gap-2">
                                <span
                                    class="claim-status badge text-uppercase {% if p.estado=='aprobada' %}bg-success{% else %}bg-danger{% endif %}">{{
                                    p.estado }}</span>
                                <form method="post" action="{{ url_for('revert_nombre_claim', claim_id=p.id) }}"
                                    style="display:inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-secondary"
                                        title="Revertir a pendiente"><i
                                            class="bi bi-arrow-counterclockwise"></i></button>
                                </form>
                            </div>
                        </div>

                        <div class="claim-body">
                            <p><strong>Usuario:</strong> {{ p.username }}</p>
                            <p><strong>Correo:</strong> {{ p.email }}</p>
                            <p><strong>Nombre actual:</strong> {{ p.nombre_actual }}</p>
                            <p><strong>Motivo:</strong></p>
                            <p class="claim-proof">{{ p.motivo | e }}</p>
                            <p class="claim-date"><small>Solicitada: {{ p.created_at }}</small></p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>No hay peticiones archivadas.</p>
                {% endif %}
                {% else %}
                <p>No hay peticiones registradas.</p>
                {% endif %}
            </div>
        </div>

        <hr class="my-5">

        <div class="claims-section">
            <div class="section-header">
                <h2><i class="bi bi-pencil-square"></i> Peticiones de edición de writeups publicados</h2>
                <p class="section-subtitle">Cambios solicitados por los autores sobre writeups ya publicados.</p>
            </div>

            <div class="section-body">
                {% if edit_requests %}
                {% set pendientes_w = edit_requests | selectattr("estado", "equalto", "pendiente") | list %}
                {% set archivadas_w = edit_requests | rejectattr("estado", "equalto", "pendiente") | list %}

                {% if pendientes_w|length > 0 %}
                <h5 class="text-warning mb-3">Pendientes</h5>
                {% for r in pendientes_w %}
                <div class="claim-card">
                    <div class="claim-header d-flex justify-content-between align-items-center">
                        <div>
                            <span class="claim-id">Petición #{{ r.id }}</span>
                            <span class="claim-meta ms-2">Writeup ID {{ r.writeup_id }}</span>
                            <span class="claim-meta ms-2">{{ r.created_at }}</span>
                            <span class="claim-meta ms-2">Usuario: {{ r.username }} (ID {{ r.user_id }})</span>
                        </div>

                        <span class="claim-status badge text-uppercase bg-warning text-dark">{{ r.estado }}</span>
                    </div>

                    <div class="claim-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Datos actuales</h5>
                                <ul class="claim-details">
                                    <li><strong>Máquina:</strong> {{ r.maquina_actual }}</li>
                                    <li><strong>Autor:</strong> {{ r.autor_actual }}</li>
                                    <li><strong>URL:</strong> <a href="{{ r.url_actual | e }}" target="_blank">{{
                                            r.url_actual | e }}</a></li>
                                    <li><strong>Tipo:</strong> {{ r.tipo_actual }}</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>Propuesta nueva</h5>
                                <ul class="claim-details">
                                    <li><strong>Máquina:</strong> {{ r.maquina_nueva }}</li>
                                    <li><strong>Autor:</strong> {{ r.autor_nuevo }}</li>
                                    <li><strong>URL:</strong> <a href="{{ r.url_nueva | e }}" target="_blank">{{
                                            r.url_nueva | e
                                            }}</a></li>
                                    <li><strong>Tipo:</strong> {{ r.tipo_nuevo }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="claim-actions d-flex gap-2 mt-3">
                        <form method="post" action="{{ url_for('writeups.approve_writeup_edit', request_id=r.id) }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-success"><i class="bi bi-check-circle"></i>
                                Aprobar</button>
                        </form>

                        <form method="post" action="{{ url_for('writeups.reject_writeup_edit', request_id=r.id) }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-x-circle"></i>
                                Rechazar</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted">No hay peticiones pendientes.</p>
                {% endif %}

                <hr class="my-4">

                {% if archivadas_w|length > 0 %}
                <button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse"
                    data-bs-target="#writeupsArchivados">Mostrar archivadas</button>

                <div class="collapse" id="writeupsArchivados">
                    {% for r in archivadas_w %}
                    <div class="claim-card mt-3">
                        <div class="claim-header d-flex justify-content-between align-items-center">
                            <div>
                                <span class="claim-id">Petición #{{ r.id }}</span>
                                <span class="claim-meta ms-2">Writeup ID {{ r.writeup_id }}</span>
                                <span class="claim-meta ms-2">{{ r.created_at }}</span>
                                <span class="claim-meta ms-2">Usuario: {{ r.username }} (ID {{ r.user_id }})</span>
                            </div>

                            <div class="d-flex align-items-center gap-2">
                                <span
                                    class="claim-status badge text-uppercase {% if r.estado == 'aprobada' %}bg-success{% else %}bg-danger{% endif %}">{{
                                    r.estado }}</span>
                                <form method="post"
                                    action="{{ url_for('writeups.revert_writeup_edit', request_id=r.id) }}"
                                    style="display:inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-secondary"
                                        title="Revertir a pendiente"><i
                                            class="bi bi-arrow-counterclockwise"></i></button>
                                </form>
                            </div>
                        </div>

                        <div class="claim-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Datos actuales</h5>
                                    <ul class="claim-details">
                                        <li><strong>Máquina:</strong> {{ r.maquina_actual }}</li>
                                        <li><strong>Autor:</strong> {{ r.autor_actual }}</li>
                                        <li><strong>URL:</strong> <a href="{{ r.url_actual | e }}" target="_blank">{{
                                                r.url_actual | e }}</a></li>
                                        <li><strong>Tipo:</strong> {{ r.tipo_actual }}</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h5>Propuesta nueva</h5>
                                    <ul class="claim-details">
                                        <li><strong>Máquina:</strong> {{ r.maquina_nueva }}</li>
                                        <li><strong>Autor:</strong> {{ r.autor_nuevo }}</li>
                                        <li><strong>URL:</strong> <a href="{{ r.url_nueva }}" target="_blank">{{
                                                r.url_nueva }}</a></li>
                                        <li><strong>Tipo:</strong> {{ r.tipo_nuevo }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No hay peticiones archivadas.</p>
                {% endif %}

                {% else %}
                <p>No hay peticiones de edición de writeups.</p>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}