{% extends "dockerlabs/base.html" %}

{% block title %}Registro - DockerLabs{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='dockerlabs/css/registro.css') }}">
{% endblock %}

{% block content %}
<div class="register-container">
    <div class="register-box">
        <div class="register-header">
            <h2>Crear Cuenta</h2>
            <p>Únete a la comunidad de DockerLabs</p>
        </div>

        {% if error %}
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span>{{ error }}</span>
        </div>
        {% endif %}

        {% if pending_message %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <span>{{ pending_message }}</span>
        </div>
        {% endif %}

        {% if recovery_pin %}
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <div>
                <strong>¡Cuenta creada exitosamente!</strong>
                <div class="pin-display">{{ recovery_pin }}</div>
                <div class="pin-warning">
                    <i class="fas fa-shield-alt"></i>
                    Guarda este PIN en un lugar seguro. Lo necesitarás para recuperar tu contraseña.
                </div>
            </div>
        </div>
        {% endif %}

        {% if remaining %}
        <div class="alert alert-warning" id="rl-warning">
            <i class="fas fa-clock"></i>
            <span>
                Debes esperar <span id="rl-seconds">{{ remaining }}</span> segundos antes de volver a intentarlo.
            </span>
        </div>

        <script nonce="{{ g.csp_nonce }}">
            (function () {
                var secondsEl = document.getElementById("rl-seconds");
                var sec = parseInt(secondsEl.textContent, 10) || 0;
                function tick() {
                    if (sec <= 0) {
                        var warn = document.getElementById("rl-warning");
                        if (warn) { warn.style.display = "none"; }
                        return;
                    }
                    sec -= 1;
                    secondsEl.textContent = sec;
                    setTimeout(tick, 1000);
                }
                setTimeout(tick, 1000);
            })();
        </script>
        {% endif %}

        <form method="post" class="register-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

            <div class="form-group">
                <label for="username"><i class="fas fa-user"></i> Nombre de usuario</label>
                <input type="text" name="username" id="username" placeholder="Elige tu nombre de usuario" required
                    autocomplete="username" autofocus minlength="3" maxlength="20">
            </div>

            <div class="form-group">
                <label for="email"><i class="fas fa-envelope"></i> Correo electrónico</label>
                <input type="email" name="email" id="email" placeholder="tu@correo.com" required autocomplete="email"
                    maxlength="35">
            </div>

            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> Contraseña</label>
                <input type="password" name="password" id="password" placeholder="Crea una contraseña segura" required
                    autocomplete="new-password">
            </div>

            <div class="form-group">
                <label for="password2"><i class="fas fa-lock"></i> Confirmar contraseña</label>
                <input type="password" name="password2" id="password2" placeholder="Repite tu contraseña" required
                    autocomplete="new-password">
            </div>

            <div class="password-requirements">
                <h6><i class="fas fa-info-circle"></i> Requisitos de la contraseña:</h6>
                <ul>
                    <li><i class="fas fa-check-circle"></i> Mínimo 8 caracteres</li>
                    <li><i class="fas fa-check-circle"></i> Al menos una mayúscula</li>
                    <li><i class="fas fa-check-circle"></i> Al menos un número</li>
                    <li><i class="fas fa-check-circle"></i> Al menos un carácter especial</li>
                </ul>
            </div>

            <div class="terms-checkbox">
                <label>
                    <input type="checkbox" id="terms" name="terms" required>
                    <span>
                        Al registrarme acepto los
                        <a href="{{ url_for('main.condiciones_uso') }}" target="_blank">Términos y Condiciones</a>
                    </span>
                </label>
            </div>

            <button type="submit" class="btn-register">
                <i class="fas fa-user-plus"></i> Crear cuenta
            </button>
        </form>

        <div class="register-divider">
            <span>¿Ya tienes cuenta?</span>
        </div>

        <div class="register-links">
            <a href="{{ url_for('auth.login') }}">
                <i class="fas fa-sign-in-alt"></i> Iniciar sesión
            </a>
        </div>

        <div class="security-badge">
            <i class="fas fa-shield-alt"></i>
            <span>Registro seguro y encriptado</span>
        </div>
    </div>
</div>
{% endblock %}